###############################################################################
#
# Golem Plugin/Ctrl/ROSCtrl library
#
###############################################################################

option(GOLEM_BUILD_PLUGIN_CTRL_ROSCTRL "Build Golem Plugin/Ctrl Katana450 plugins" NO)
mark_as_advanced(GOLEM_BUILD_PLUGIN_CTRL_ROSCTRL)

if(GOLEM_BUILD_PLUGIN_CTRL AND GOLEM_BUILD_PLUGIN_CTRL_ROSCTRL)
	SET(PACKAGE_DIR "${PACKAGE_PLUGIN_CTRL}/ROSCtrl")

	SET(ROS_INSTALL_PATH "/opt/ros/indigo" CACHE PATH "Path for ROS instalation")
	SET(ROS_INCLUDE_DIR ${ROS_INSTALL_PATH}/include)
	SET(ROS_LIBRARY_DIR ${ROS_INSTALL_PATH}/lib)
	SET(ROS_LIBRARIES roscpp roscpp_serialization)  # what libraries to link to
	
	FILE(GLOB_RECURSE PACKAGE_SOURCES "${PACKAGE_DIR}/src/*.cpp")
	FILE(GLOB_RECURSE PACKAGE_HEADERS "${PACKAGE_DIR}/include/*.h")
	FILE(GLOB_RECURSE PACKAGE_FILES "${PACKAGE_DIR}/resources/*.xml")

	if(GOLEM_DYNAMIC_LIBS)
		ADD_LIBRARY(GolemCtrlROSCtrl SHARED ${PACKAGE_SOURCES} ${PACKAGE_HEADERS} ${PACKAGE_FILES})
		TARGET_COMPILE_OPTIONS(GolemCtrlROSCtrl PUBLIC ${CMAKE_DLL_EXPORT_FLAGS})
	else(GOLEM_DYNAMIC_LIBS)
		ADD_LIBRARY(GolemCtrlROSCtrl STATIC ${PACKAGE_SOURCES} ${PACKAGE_HEADERS} ${PACKAGE_FILES})
	endif(GOLEM_DYNAMIC_LIBS)

	TARGET_LINK_LIBRARIES(GolemCtrlROSCtrl GolemCtrlSingleCtrl ${ROS_LIBRARIES})
	
	TARGET_INCLUDE_DIRECTORIES(GolemCtrlROSCtrl PUBLIC ${PACKAGE_DIR}/include ${ROS_INCLUDE_DIR})

	if (CPACK_BUILD_CORE)
		if(GOLEM_DYNAMIC_LIBS)
			if (WIN32)
				INSTALL(TARGETS GolemCtrlROSCtrl RUNTIME DESTINATION bin COMPONENT ctrl_libs)
			elseif (UNIX)
				INSTALL(TARGETS GolemCtrlROSCtrl LIBRARY DESTINATION bin COMPONENT ctrl_libs)
			endif()
		else(GOLEM_DYNAMIC_LIBS)
			INSTALL(TARGETS GolemCtrlROSCtrl ARCHIVE DESTINATION lib COMPONENT ctrl_libs)
		endif(GOLEM_DYNAMIC_LIBS)
		INSTALL(FILES ${PACKAGE_HEADERS} DESTINATION include/Golem/Ctrl/ROSCtrl/ COMPONENT ctrl_headers)
		INSTALL(FILES ${PACKAGE_FILES} DESTINATION bin COMPONENT ctrl_configs)
	endif (CPACK_BUILD_CORE)

	SET_PROPERTY(TARGET GolemCtrlROSCtrl PROPERTY PROJECT_LABEL "ROSCtrl")
	SET_PROPERTY(TARGET GolemCtrlROSCtrl PROPERTY FOLDER "Plugin/Ctrl")
	SOURCE_GROUP("Include Files" FILES ${PACKAGE_HEADERS})
	SOURCE_GROUP("Resource Files" FILES ${PACKAGE_FILES})
else(GOLEM_BUILD_PLUGIN_CTRL AND GOLEM_BUILD_PLUGIN_CTRL_ROSCTRL)
	UNSET(ROS_INSTALL_PATH CACHE)
endif(GOLEM_BUILD_PLUGIN_CTRL AND GOLEM_BUILD_PLUGIN_CTRL_ROSCTRL)
