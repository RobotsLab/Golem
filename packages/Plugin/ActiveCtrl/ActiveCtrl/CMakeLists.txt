###############################################################################
#
# Golem Plugin/ActiveCtrl/ActiveCtrl library
#
###############################################################################

if(GOLEM_BUILD_PLUGIN_ACTIVECTRL)
	option(GOLEM_BUILD_PLUGIN_ACTIVECTRL_SFML "Build Plugin/ActiveCtrl/ActiveCtrl SFML joystick support" NO)
	mark_as_advanced(GOLEM_BUILD_PLUGIN_ACTIVECTRL_SFML)
	if(GOLEM_BUILD_PLUGIN_ACTIVECTRL_SFML)
		SET(CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} "${GOLEM_PROJECT_CMAKE_MODULES}")
		FIND_PACKAGE(SFML 2 REQUIRED system window)
	endif(GOLEM_BUILD_PLUGIN_ACTIVECTRL_SFML)

	SET(PACKAGE_DIR "${PACKAGE_PLUGIN_ACTIVECTRL}/ActiveCtrl")

	#FILE(GLOB_RECURSE PACKAGE_SOURCES "${PACKAGE_DIR}/src/*.cpp")
	SET(PACKAGE_SOURCES
		${PACKAGE_DIR}/src/ActiveCtrlForce.cpp
		${PACKAGE_DIR}/src/ActiveSingleCtrl.cpp
	)
	if(GOLEM_BUILD_PLUGIN_ACTIVECTRL_SFML)
		SET(PACKAGE_SOURCES
			${PACKAGE_SOURCES}
			${PACKAGE_DIR}/src/InputCtrl.cpp
		)
	endif(GOLEM_BUILD_PLUGIN_ACTIVECTRL_SFML)

	#FILE(GLOB_RECURSE PACKAGE_HEADERS "${PACKAGE_DIR}/include/*.h")
	SET(PACKAGE_HEADERS
		${PACKAGE_DIR}/include/Golem/ActiveCtrl/ActiveCtrl/ActiveCtrlForce.h
		${PACKAGE_DIR}/include/Golem/ActiveCtrl/ActiveCtrl/ActiveSingleCtrl.h
	)
	if(GOLEM_BUILD_PLUGIN_ACTIVECTRL_SFML)
		SET(PACKAGE_HEADERS
			${PACKAGE_HEADERS}
		${PACKAGE_DIR}/include/Golem/ActiveCtrl/ActiveCtrl/InputCtrl.h
		)
	endif(GOLEM_BUILD_PLUGIN_ACTIVECTRL_SFML)

	#FILE(GLOB_RECURSE PACKAGE_FILES "${PACKAGE_DIR}/resources/*.xml")

	if(GOLEM_DYNAMIC_LIBS)
		ADD_LIBRARY(GolemActiveCtrl SHARED ${PACKAGE_SOURCES} ${PACKAGE_HEADERS} ${PACKAGE_FILES})
		TARGET_COMPILE_OPTIONS(GolemActiveCtrl PUBLIC ${CMAKE_DLL_EXPORT_FLAGS})
	else(GOLEM_DYNAMIC_LIBS)
		ADD_LIBRARY(GolemActiveCtrl STATIC ${PACKAGE_SOURCES} ${PACKAGE_HEADERS} ${PACKAGE_FILES})
	endif(GOLEM_DYNAMIC_LIBS)

	TARGET_LINK_LIBRARIES(GolemActiveCtrl GolemPlugin GolemCtrlSingleCtrl)
	if(GOLEM_BUILD_PLUGIN_ACTIVECTRL_SFML)
		TARGET_LINK_LIBRARIES(GolemActiveCtrl ${SFML_LIBRARIES} ${SFML_DEPENDENCIES})	
	endif(GOLEM_BUILD_PLUGIN_ACTIVECTRL_SFML)

	TARGET_INCLUDE_DIRECTORIES(GolemActiveCtrl PUBLIC ${PACKAGE_DIR}/include)
	if(GOLEM_BUILD_PLUGIN_ACTIVECTRL_SFML)
		TARGET_INCLUDE_DIRECTORIES(GolemActiveCtrl PUBLIC ${SFML_INCLUDE_DIR})
	endif(GOLEM_BUILD_PLUGIN_ACTIVECTRL_SFML)

	if (CPACK_BUILD_CORE)
		if(GOLEM_DYNAMIC_LIBS)
			if (WIN32)
				INSTALL(TARGETS GolemActiveCtrl RUNTIME DESTINATION bin COMPONENT activectrl_libs)
			elseif (UNIX)
				INSTALL(TARGETS GolemActiveCtrl LIBRARY DESTINATION bin COMPONENT activectrl_libs)
			endif()
		else(GOLEM_DYNAMIC_LIBS)
			INSTALL(TARGETS GolemActiveCtrl ARCHIVE DESTINATION lib COMPONENT activectrl_libs)
		endif(GOLEM_DYNAMIC_LIBS)
		INSTALL(FILES ${PACKAGE_HEADERS} DESTINATION include/Golem/ActiveCtrl/ActiveCtrl/ COMPONENT activectrl_headers)
		INSTALL(FILES ${PACKAGE_FILES} DESTINATION bin COMPONENT activectrl_configs)
	endif (CPACK_BUILD_CORE)

	SET_PROPERTY(TARGET GolemActiveCtrl PROPERTY PROJECT_LABEL "ActiveCtrl")
	SET_PROPERTY(TARGET GolemActiveCtrl PROPERTY FOLDER "Plugin/ActiveCtrl")
	SOURCE_GROUP("Include Files" FILES ${PACKAGE_HEADERS})
	SOURCE_GROUP("Resource Files" FILES ${PACKAGE_FILES})
endif(GOLEM_BUILD_PLUGIN_ACTIVECTRL)
