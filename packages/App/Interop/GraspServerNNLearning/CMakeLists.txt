###############################################################################
#
# Golem App/Interop/GraspServerNNLearning application
#
###############################################################################

option(GOLEM_BUILD_APP_GRASP_SERVER_NNLEARNING "Build Interop GraspServerNNLearning application" NO)
mark_as_advanced(GOLEM_BUILD_APP_GRASP_SERVER_NNLEARNING)

if(GOLEM_BUILD_APP_GRASP_SERVER_NNLEARNING)
	# EXTERN
	option(GOLEM_BUILD_APP_GRASP_SERVER_NNLEARNING_TEST "Build Interop GraspServerNNLearning test without EXTERN" YES)
	mark_as_advanced(GOLEM_BUILD_APP_GRASP_SERVER_NNLEARNING_TEST)
	if(NOT GOLEM_BUILD_APP_GRASP_SERVER_NNLEARNING_TEST)
		SET(EXTERN_DIR "${GOLEM_PROJECT_PARENT}/extern" CACHE PATH "EXTERN directory")

		# OpenCV
	endif(NOT GOLEM_BUILD_APP_GRASP_SERVER_NNLEARNING_TEST)

	# Boost
	if (WIN32)
		ADD_DEFINITIONS(-DBOOST_ALL_NO_LIB)
		SET(Boost_USE_STATIC_LIBS ON)
		SET(Boost_ALL_DYN_LINK OFF)
	elseif (UNIX)
		#ADD_DEFINITIONS(-DBOOST_ALL_NO_LIB)
		#SET(Boost_USE_STATIC_LIBS OFF)
		#SET(Boost_ALL_DYN_LINK ON)
	endif ()
	FIND_PACKAGE(Boost COMPONENTS system)
	
	# PCL
	FIND_PACKAGE(PCL REQUIRED)
	list(REMOVE_ITEM PCL_LIBRARIES "vtkproj4") # PCL bug
	FIND_PACKAGE(OpenCV REQUIRED)
	
	SET(PACKAGE_DIR "${PACKAGE_APP}/Interop/GraspServerNNLearning")

	FILE(GLOB_RECURSE PACKAGE_SOURCES "${PACKAGE_DIR}/src/*.cpp")
	FILE(GLOB_RECURSE PACKAGE_HEADERS "${PACKAGE_DIR}/include/*.h")
	FILE(GLOB_RECURSE PACKAGE_FILES "${PACKAGE_DIR}/resources/*.xml")

	ADD_EXECUTABLE(GolemGraspServerNNLearning ${PACKAGE_SOURCES} ${PACKAGE_HEADERS} ${PACKAGE_FILES})

	if (WIN32)
		TARGET_COMPILE_OPTIONS(GolemGraspServerNNLearning PUBLIC /wd4996 /wd4005)
	elseif (UNIX)
		TARGET_COMPILE_OPTIONS(GolemGraspServerNNLearning PUBLIC -Wno-invalid-offsetof)
	endif()

	if(NOT GOLEM_BUILD_APP_GRASP_SERVER_NNLEARNING_TEST)
		TARGET_COMPILE_DEFINITIONS(GolemGraspServerNNLearning
			PUBLIC _EXTERN_LIB_=1
			#PUBLIC ${OPENCV_DEFINITIONS}
		)
	endif(NOT GOLEM_BUILD_APP_GRASP_SERVER_NNLEARNING_TEST)
	
	#TARGET_INCLUDE_DIRECTORIES(GolemGraspServerNNLearning PUBLIC ${PACKAGE_DIR}/include ${GOLEM_PROJECT_PACKAGES}/App/UI/Grasp/include)
	TARGET_INCLUDE_DIRECTORIES(GolemGraspServerNNLearning
		PUBLIC ${PACKAGE_DIR}/include
		PUBLIC ${GOLEM_PROJECT_PACKAGES}/App/UI/Grasp/include
		PUBLIC ${GOLEM_PROJECT_PACKAGES}/Interop/Interop/Core/include/Golem/Interop
		PUBLIC ${GOLEM_PROJECT_PACKAGES}/Interop/Interop/Contact/include/Golem/Interop
		PUBLIC ${GOLEM_PROJECT_PACKAGES}/Interop/Interop/PCL/include/Golem/Interop
		PUBLIC ${Boost_INCLUDE_DIRS}
		PUBLIC ${PCL_INCLUDE_DIRS}
		PUBLIC ${OPENCV_INCLUDE_DIRS}
	)
	if(NOT GOLEM_BUILD_APP_GRASP_SERVER_NNLEARNING_TEST)
		TARGET_INCLUDE_DIRECTORIES(GolemGraspServerNNLearning
			#PUBLIC ${OPENCV_INCLUDE_DIRS}
			PUBLIC ${EXTERN_DIR}/include
		)
	endif(NOT GOLEM_BUILD_APP_GRASP_SERVER_NNLEARNING_TEST)

	#TARGET_LINK_LIBRARIES(GolemGraspServerNNLearning GolemInteropContact GolemInteropPCL)
	TARGET_LINK_LIBRARIES(GolemGraspServerNNLearning
		${Boost_LIBRARIES}
		${PCL_LIBRARIES}
		${OpenCV_LIBS}
	)
	if (UNIX)
		TARGET_LINK_LIBRARIES(GolemGraspServerNNLearning ${CMAKE_DL_LIBS})
	endif ()
	if(NOT GOLEM_BUILD_APP_GRASP_SERVER_NNLEARNING_TEST)
		TARGET_LINK_LIBRARIES(GolemGraspServerNNLearning
			${OpenCV_LIBS}
			extern
		)
		if (UNIX)
			#TARGET_LINK_LIBRARIES(GolemGraspServerNNLearning)
		endif ()
	endif(NOT GOLEM_BUILD_APP_GRASP_SERVER_NNLEARNING_TEST)
	
	COPY_FILES(GolemGraspServerNNLearning ${RUNTIME_OUTPUT_DIRECTORY} ${PACKAGE_FILES})
	SET_PROPERTY(TARGET GolemGraspServerNNLearning PROPERTY RELEASE_POSTFIX ${CMAKE_RELEASE_POSTFIX})
	SET_PROPERTY(TARGET GolemGraspServerNNLearning PROPERTY DEBUG_POSTFIX ${CMAKE_DEBUG_POSTFIX})
	
	if (CPACK_BUILD_CORE)
		INSTALL(TARGETS GolemGraspServerNNLearning RUNTIME DESTINATION bin COMPONENT app_execs)
		INSTALL(FILES ${PACKAGE_HEADERS} DESTINATION include/Golem/Interop/GraspServerNNLearning/ COMPONENT app_headers)
		INSTALL(FILES ${PACKAGE_FILES} DESTINATION bin COMPONENT app_configs)
	endif (CPACK_BUILD_CORE)

	SET_PROPERTY(TARGET GolemGraspServerNNLearning PROPERTY PROJECT_LABEL "GraspServerNNLearning")
	SET_PROPERTY(TARGET GolemGraspServerNNLearning PROPERTY FOLDER "App/Interop")
	SOURCE_GROUP("Include Files" FILES ${PACKAGE_HEADERS})
	SOURCE_GROUP("Resource Files" FILES ${PACKAGE_FILES})
endif(GOLEM_BUILD_APP_GRASP_SERVER_NNLEARNING)
